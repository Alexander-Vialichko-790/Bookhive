{% extends "base.html" %}
{% block title %}–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow">
        <div class="card-body">
          <h4 class="card-title text-center mb-4">üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Ññ{{ order.id }}</h4>
          <h4 class="text-center mb-4">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: <strong>{{ final_total }} ‚ÇΩ</strong></h4>

          <form method="post" novalidate>
            {% csrf_token %}
            <div class="mb-3">
              <label for="card_number" class="form-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
              <input type="text" class="form-control" id="card_number" name="card_number"
                     placeholder="1234 5678 9012 3456"
                     pattern="^\d{4} \d{4} \d{4} \d{4}$"
                     title="–í–≤–µ–¥–∏—Ç–µ 16 —Ü–∏—Ñ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1234 5678 9012 3456)"
                     required maxlength="19">
            </div>

            <div class="row mb-3">
              <div class="col">
                <label for="expiry" class="form-label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                <input type="text" class="form-control" id="expiry" name="expiry"
                       placeholder="MM/YY"
                       pattern="^(0[1-9]|1[0-2])\/\d{2}$"
                       title="–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM/YY"
                       required maxlength="5">
              </div>
              <div class="col">
                <label for="cvv" class="form-label">CVV</label>
                <input type="text" class="form-control" id="cvv" name="cvv"
                       placeholder="123"
                       pattern="^\d{3}$"
                       title="–í–≤–µ–¥–∏—Ç–µ 3 —Ü–∏—Ñ—Ä—ã CVV"
                       required maxlength="3">
              </div>
            </div>

            <button type="submit" class="btn btn-success w-100">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // –ú–∞—Å–∫–∞ –¥–ª—è –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
  const cardInput = document.getElementById('card_number');
  cardInput.addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '').substring(0, 16);
    let formatted = value.replace(/(.{4})/g, '$1 ').trim();
    e.target.value = formatted;
  });

  // –ú–∞—Å–∫–∞ –¥–ª—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  const expiryInput = document.getElementById('expiry');
  expiryInput.addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '').substring(0, 4);
    if (value.length >= 3) {
      value = value.replace(/(\d{2})(\d{1,2})/, '$1/$2');
    }
    e.target.value = value;
  });
</script>
{% endblock %}
