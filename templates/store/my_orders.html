{% extends "base.html" %}
{% block title %}–ú–æ–∏ –∑–∞–∫–∞–∑—ã{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
      {% include "store/partials/account_sidebar.html" %}
    </div>

    <!-- Orders Content -->
    <div class="col-md-9">
      <h2 class="mb-4">üßæ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>

      {% if orders_with_totals %}
        <div class="row g-4">
          {% for entry in orders_with_totals %}
            {% with order=entry.order final_total=entry.final_total %}
              <div class="col-12">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">
                      <strong>–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</strong>
                    </h5>
                    <p class="card-text mb-2">
                      <i class="bi bi-clock"></i>
                      {{ order.created|date:"d.m.Y H:i" }} <br>
                      <i class="bi bi-info-circle"></i>
                      <em>{{ order.get_status_display }}</em> <br>
                      <i class="bi bi-currency-ruble"></i>
                      <strong>{{ final_total }} ‚ÇΩ</strong>
                      {% if order.cashback_used > 0 %}
                        <small class="text-muted">(–≤–∫–ª—é—á–∞—è -{{ order.cashback_used }} ‚ÇΩ –±–æ–Ω—É—Å–æ–≤)</small>
                      {% endif %}
                    </p>

                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <a href="{% url 'order_detail' order.id %}" class="btn btn-outline-primary">
                        üìÑ –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
                      </a>
                      {% if order.status == 'pending' and not order.is_paid %}
                        <a href="{% url 'payment_view' order.pk %}" class="btn btn-success">–û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑</a>
                      {% endif %}

                      {% if order.can_be_cancelled %}
                        <form method="post" action="{% url 'cancel_order' order.id %}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?');">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-danger">
                            ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
                          </button>
                        </form>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endwith %}
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info text-center" role="alert">
          –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
