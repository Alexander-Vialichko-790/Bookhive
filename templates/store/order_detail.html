{% extends "base.html" %}
{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
      {% include "store/partials/account_sidebar.html" %}
    </div>

    <!-- Order Details -->
    <div class="col-md-9">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-center mb-4">üßæ –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ ‚Ññ{{ order.id }}</h3>

          <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item">
              <strong>üì¶ –°—Ç–∞—Ç—É—Å:</strong> {{ order.get_status_display }}
            </li>
            <li class="list-group-item">
              <strong>üïí –î–∞—Ç–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:</strong> {{ order.created|date:"d.m.Y H:i" }}
            </li>
            <li class="list-group-item">
              <strong>üí∞ –°—É–º–º–∞:</strong> {{ order.get_total_cost }} ‚ÇΩ
            </li>
            <li class="list-group-item">
                <strong>üí≥ –°—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –∫—ç—à–±—ç–∫–∞:</strong> {{ cart_total }} ‚ÇΩ
              </li>
              <li class="list-group-item">
                <strong>üéÅ –°–ø–∏—Å–∞–Ω–æ —Å –±–æ–Ω—É—Å–Ω–æ–≥–æ —Å—á—ë—Ç–∞:</strong> -{{ cashback_used }} ‚ÇΩ
              </li>
              <li class="list-group-item">
                <strong>üí∏ –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</strong> {{ final_total }} ‚ÇΩ
              </li>
              <li class="list-group-item">
                <strong>üü¢ –ö—ç—à–±—ç–∫ –∑–∞ –∑–∞–∫–∞–∑:</strong> +{{ cashback_earned }} ‚ÇΩ
              </li>
              <li class="list-group-item">
                <strong>üí∞ –í–∞—à –±–æ–Ω—É—Å–Ω—ã–π —Å—á—ë—Ç:</strong> {{ bonus_balance }} ‚ÇΩ
              </li>              
            <li class="list-group-item">
              <strong>üë§ –ò–º—è:</strong> {{ order.first_name }} {{ order.last_name }}
            </li>
            <li class="list-group-item">
              <strong>üìß Email:</strong> {{ order.email }}
            </li>
            <li class="list-group-item">
              <strong>üì± –¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone }}
            </li>
            <li class="list-group-item">
              <strong>üè† –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.address }}
            </li>
          </ul>

          <h5 class="fw-bold mb-3">üìö –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ:</h5>
          <ul class="list-group mb-4">
            {% for item in items %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ item.book.title }}
                <span class="text-muted">
                  {{ item.quantity }} —à—Ç. √ó {{ item.price }} ‚ÇΩ
                </span>
              </li>
            {% endfor %}
          </ul>

          {% if order.can_be_cancelled %}
            <div class="d-flex justify-content-between align-items-center mt-4">
              <form method="post" action="{% url 'cancel_order' order.id %}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">
                  ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
              </form>

              <a href="{% url 'edit_order' order.id %}" class="btn btn-primary">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑
              </a>
            </div>
          {% endif %}

          {% if order.status == 'pending' and not order.is_paid %}
          <div class="mt-4 d-flex justify-content-center">
            <a href="{% url 'payment_view' order.pk %}" class="btn btn-success btn-lg">
              üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑
            </a>
          </div>
        {% endif %}      
        

          <div class="text-center mt-4">
            <a href="{% url 'my_orders' %}" class="btn btn-outline-secondary">
              ‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
            </a>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
